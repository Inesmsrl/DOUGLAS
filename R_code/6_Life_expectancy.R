################################################################################################################################
#                                             1. Chargement des packages                                                       #
################################################################################################################################

pacman::p_load(
  rio,                 # Importation de fichiers
  here,                # Localisation des fichiers dans le dossier du projet
  dplyr,               # Manipulation des données
  tidyr
)


################################################################################################################################
#                                             2. Importation des données                                                       #
################################################################################################################################

population_evo <- import(here("data_clean", "data_evolution.xlsx"))

################################################################################################################################
#                                             3. Âge moyen au décès                                                            #
################################################################################################################################

population_evo <- population_evo %>% 
  select("age", "year", "scenario", "MR", "population", "deaths")

life_exp = function(df, MR ,age){
  test = df %>%
    mutate(prop_alive = cumprod(1 - MR),
           deaths =  -(prop_alive - lag(prop_alive)),
           life_exp = sum(age*deaths, na.rm = T))
  return(test)
}

le <- life_exp(population_evo)

################################################################################################################################
#                                             4. Exportation des données                                                       #
################################################################################################################################

export(le, here("data_clean", "life_expectancy.xlsx"))
